# ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë¶„ì„ ë¦¬í¬íŠ¸

**ìƒì„±ì¼**: 2025-11-27  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-27 07:16 (ìµœì í™” ì ìš© í›„)  
**ë°ì´í„°ë² ì´ìŠ¤**: erp  
**ë¶„ì„ ë„êµ¬**: `database/scripts/analyze_schema.php`

---

## ğŸ“Š ì „ì²´ ìš”ì•½

### í…Œì´ë¸” êµ¬ì„±
- **ì´ í…Œì´ë¸” ìˆ˜**: 37ê°œ âœ…
  - ìš´ì˜ í…Œì´ë¸”: 37ê°œ
  - ~~ë°±ì—… í…Œì´ë¸”: 3ê°œ~~ â†’ **ì‚­ì œ ì™„ë£Œ**
- **ë·°**: 2ê°œ
  - `v_employee_leave_status` - ì§ì› ì—°ì°¨ í˜„í™©
  - `v_vehicle_consumable_inventory` - ì°¨ëŸ‰ ì†Œëª¨í’ˆ ì¬ê³ 

### ì¸ë±ìŠ¤ í†µê³„
- **ì´ ì¸ë±ìŠ¤ ìˆ˜**: 140ê°œ âœ… (ì¤‘ë³µ ì¸ë±ìŠ¤ 2ê°œ ì œê±° ì™„ë£Œ)
  - PRIMARY KEY: 37ê°œ
  - UNIQUE INDEX: 13ê°œ
  - REGULAR INDEX: 90ê°œ

### ì™¸ë˜ í‚¤ í†µê³„
- **ì´ ì™¸ë˜ í‚¤ ìˆ˜**: 51ê°œ
- **ì¸ë±ìŠ¤ ê²€ì¦**: âœ… ëª¨ë“  ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ê°€ ì¡´ì¬í•©ë‹ˆë‹¤

---

## ğŸ” ëª¨ë“ˆë³„ ìƒì„¸ ë¶„ì„

### 1. HR (Human Resources) ëª¨ë“ˆ

#### í…Œì´ë¸” êµ¬ì„± (7ê°œ)
1. **hr_departments** (ë¶€ì„œ ì •ë³´)
   - ì»¬ëŸ¼: 6ê°œ | ì¸ë±ìŠ¤: 3ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - ìê¸° ì°¸ì¡° ì™¸ë˜ í‚¤: parent_id â†’ hr_departments.id
   - ì¸ë±ìŠ¤: PRIMARY, UNIQUE(name), INDEX(parent_id)

2. **hr_employees** (ì§ì› ì •ë³´) 
   - ì»¬ëŸ¼: 19ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - ì™¸ë˜ í‚¤: department_id â†’ hr_departments, position_id â†’ hr_positions
   - ì¸ë±ìŠ¤: PRIMARY, UNIQUE(employee_number), INDEX(name, department_id, position_id)

3. **hr_positions** (ì§ê¸‰ ì •ë³´)
   - ì»¬ëŸ¼: 5ê°œ | ì¸ë±ìŠ¤: 2ê°œ
   - ì¸ë±ìŠ¤: PRIMARY, UNIQUE(name)

4. **hr_leave_applications** (ì—°ì°¨ ì‹ ì²­)
   - ì»¬ëŸ¼: 14ê°œ | ì¸ë±ìŠ¤: 7ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (employee_id, start_date, end_date), (status, created_at)
   - ì„±ëŠ¥ ìµœì í™”ê°€ ì˜ ë˜ì–´ ìˆìŒ âœ…

5. **hr_leave_logs** (ì—°ì°¨ ë³€ë™ ë¡œê·¸)
   - ì»¬ëŸ¼: 12ê°œ | ì¸ë±ìŠ¤: 9ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (employee_id, created_at), (employee_id, grant_year)
   - ë¡œê·¸ ì¡°íšŒ ì„±ëŠ¥ì„ ìœ„í•œ ì¸ë±ìŠ¤ êµ¬ì„± ìš°ìˆ˜ âœ…

6. **hr_leave_cancellations** (ì—°ì°¨ ì·¨ì†Œ ì‹ ì²­)
   - ì»¬ëŸ¼: 10ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 3ê°œ

7. **hr_leave_policies** (ì—°ì°¨ ì •ì±…)
   - ì»¬ëŸ¼: 10ê°œ | ì¸ë±ìŠ¤: 3ê°œ
   - UNIQUE(policy_year) - ì—°ë„ë³„ ë‹¨ì¼ ì •ì±… ë³´ì¥

#### ê´€ê³„ í…Œì´ë¸”
- **hr_department_managers**: ë¶€ì„œ-ë¶€ì„œì¥ ë§¤í•‘ (ë³µí•© PK)
- **hr_department_view_permissions**: ë¶€ì„œê°„ ì¡°íšŒ ê¶Œí•œ (ë³µí•© PK)

#### ê°ì‚¬ ë¡œê·¸
- **hr_employee_change_logs**: ì§ì› ì •ë³´ ë³€ê²½ ì´ë ¥ ì¶”ì 

---

### 2. Supply (ì§€ê¸‰í’ˆ) ëª¨ë“ˆ

#### í…Œì´ë¸” êµ¬ì„± (6ê°œ)

1. **supply_categories** (ì§€ê¸‰í’ˆ ë¶„ë¥˜)
   - ì»¬ëŸ¼: 9ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - ìê¸° ì°¸ì¡° ì™¸ë˜ í‚¤: parent_id (ê³„ì¸µ êµ¬ì¡°)
   - ë¶„ë¥˜ ì½”ë“œ: UNIQUE(category_code)
   - ì¸ë±ìŠ¤: level, active, parent_id

2. **supply_items** (ì§€ê¸‰í’ˆ ë§ˆìŠ¤í„°)
   - ì»¬ëŸ¼: 9ê°œ | ì¸ë±ìŠ¤: 4ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - UNIQUE(item_code) âœ…
   - ~~ì¤‘ë³µ ì¸ë±ìŠ¤: `idx_item_code`~~ â†’ **ì œê±° ì™„ë£Œ** âœ…

3. **supply_stocks** (ì¬ê³  ê´€ë¦¬)
   - ì»¬ëŸ¼: 6ê°œ | ì¸ë±ìŠ¤: 3ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - UNIQUE(item_id) - í’ˆëª©ë‹¹ ë‹¨ì¼ ì¬ê³  ë ˆì½”ë“œ
   - VIRTUAL ì»¬ëŸ¼: current_stock (ìë™ ê³„ì‚°)
   - ~~ì¤‘ë³µ ì¸ë±ìŠ¤: `idx_item_id`~~ â†’ **ì œê±° ì™„ë£Œ** âœ…

4. **supply_purchases** (êµ¬ë§¤ ë‚´ì—­)
   - ì»¬ëŸ¼: 13ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (item_id, purchase_date) âœ…
   - VIRTUAL ì»¬ëŸ¼: total_amount

5. **supply_distributions** (ì§€ê¸‰ ë‚´ì—­)
   - ì»¬ëŸ¼: 14ê°œ | ì¸ë±ìŠ¤: 7ê°œ | ì™¸ë˜ í‚¤: 5ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (employee_id, distribution_date), (department_id, distribution_date), (item_id, distribution_date)
   - ë‹¤ì–‘í•œ ì¡°íšŒ íŒ¨í„´ì„ ìœ„í•œ ì¸ë±ìŠ¤ êµ¬ì„± ìš°ìˆ˜ âœ…

6. **supply_plans** (ì—°ê°„ ê³„íš)
   - ì»¬ëŸ¼: 10ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - UNIQUE(year, item_id) - ì—°ë„/í’ˆëª©ë³„ ë‹¨ì¼ ê³„íš
   - VIRTUAL ì»¬ëŸ¼: total_budget

#### ì§€ê¸‰ ë¬¸ì„œ ê´€ë¦¬
- **supply_distribution_documents**: ì§€ê¸‰ ë¬¸ì„œ í—¤ë”
- **supply_distribution_document_employees**: ë¬¸ì„œ-ì§ì› ë§¤í•‘
- **supply_distribution_document_items**: ë¬¸ì„œ-í’ˆëª© ë§¤í•‘

---

### 3. Vehicle (ì°¨ëŸ‰) ëª¨ë“ˆ

#### í…Œì´ë¸” êµ¬ì„± (7ê°œ)

1. **vehicles** (ì°¨ëŸ‰ ì •ë³´)
   - ì»¬ëŸ¼: 12ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - UNIQUE(vehicle_number) âœ…
   - ì¸ë±ìŠ¤: department_id, driver_employee_id, vehicle_type

2. **vehicle_maintenance** (ì •ë¹„ ì´ë ¥)
   - ì»¬ëŸ¼: 23ê°œ | ì¸ë±ìŠ¤: 4ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (type, status) âœ…
   - ë‹¤ì–‘í•œ ì‚¬ì§„ ì»¬ëŸ¼ (photo_path, photo_path2, ~7)

3. **vehicle_inspections** (ê²€ì‚¬ ì´ë ¥)
   - ì»¬ëŸ¼: 9ê°œ | ì¸ë±ìŠ¤: 3ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - INDEX(expiry_date) - ë§Œë£Œì¼ ì¡°íšŒ ìµœì í™” âœ…

4. **vehicle_consumables_categories** (ì†Œëª¨í’ˆ ë¶„ë¥˜)
   - ì»¬ëŸ¼: 10ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - ê³„ì¸µ êµ¬ì¡°: parent_id, level, path
   - ì¸ë±ìŠ¤: name, parent, level, path âœ…

5. **vehicle_consumable_stock** (ì†Œëª¨í’ˆ ì¬ê³ )
   - ì»¬ëŸ¼: 9ê°œ | ì¸ë±ìŠ¤: 4ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: category_id, item_name
   - INDEX(purchase_date)

6. **vehicle_consumable_usage** (ì†Œëª¨í’ˆ ì‚¬ìš©)
   - ì»¬ëŸ¼: 11ê°œ | ì¸ë±ìŠ¤: 7ê°œ | ì™¸ë˜ í‚¤: 3ê°œ
   - ì™¸ë˜ í‚¤: category_id, consumable_id, maintenance_id
   - ë³µí•© ì¸ë±ìŠ¤: category_id, item_name
   - ë‹¤ì–‘í•œ ì¡°íšŒë¥¼ ìœ„í•œ ì¸ë±ìŠ¤ êµ¬ì„± ìš°ìˆ˜ âœ…

7. **vehicle_documents** (ì°¨ëŸ‰ ë¬¸ì„œ)
   - ì»¬ëŸ¼: 5ê°œ | ì¸ë±ìŠ¤: 2ê°œ | ì™¸ë˜ í‚¤: 1ê°œ

---

### 4. Waste (íê¸°ë¬¼) ëª¨ë“ˆ

#### í…Œì´ë¸” êµ¬ì„± (2ê°œ)

1. **waste_collections** (ëŒ€í˜•íê¸°ë¬¼ ìˆ˜ê±°)
   - ì»¬ëŸ¼: 18ê°œ | ì¸ë±ìŠ¤: 4ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (latitude, longitude) - ì§€ë„ ì¡°íšŒ ìµœì í™” âœ…
   - ì™¸ë˜ í‚¤: created_by, completed_by

2. **waste_collection_items** (ìˆ˜ê±° í’ˆëª©)
   - ì»¬ëŸ¼: 4ê°œ | ì¸ë±ìŠ¤: 2ê°œ | ì™¸ë˜ í‚¤: 1ê°œ

3. **illegal_disposal_cases2** (ë¶€ì ì • ë°°ì¶œ)
   - ì»¬ëŸ¼: 23ê°œ | ì¸ë±ìŠ¤: 4ê°œ
   - ë³µí•© ì¸ë±ìŠ¤: (latitude, longitude) âœ…
   - INDEX(waste_type, status)

---

### 5. System (ì‹œìŠ¤í…œ) ëª¨ë“ˆ

#### ì¸ì¦/ê¶Œí•œ (6ê°œ)

1. **sys_users** (ì‚¬ìš©ì ê³„ì •)
   - ì»¬ëŸ¼: 9ê°œ | ì¸ë±ìŠ¤: 3ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - UNIQUE(kakao_id, employee_id) âœ…
   - status ENUM íƒ€ì…

2. **sys_roles** (ì—­í• )
   - ì»¬ëŸ¼: 3ê°œ | ì¸ë±ìŠ¤: 2ê°œ
   - UNIQUE(name)

3. **sys_permissions** (ê¶Œí•œ)
   - ì»¬ëŸ¼: 3ê°œ | ì¸ë±ìŠ¤: 2ê°œ
   - UNIQUE(key)

4. **sys_role_permissions** (ì—­í• -ê¶Œí•œ ë§¤í•‘)
   - ë³µí•© PRIMARY KEY âœ…
   - ì™¸ë˜ í‚¤: role_id, permission_id

5. **sys_user_roles** (ì‚¬ìš©ì-ì—­í•  ë§¤í•‘)
   - ë³µí•© PRIMARY KEY âœ…
   - ì™¸ë˜ í‚¤: user_id, role_id

6. **sys_menus** (ë©”ë‰´ êµ¬ì„±)
   - ì»¬ëŸ¼: 7ê°œ | ì¸ë±ìŠ¤: 2ê°œ | ì™¸ë˜ í‚¤: 1ê°œ
   - ìê¸° ì°¸ì¡°: parent_id

#### ê°ì‚¬ ë¡œê·¸

7. **sys_activity_logs** (í™œë™ ë¡œê·¸)
   - ì»¬ëŸ¼: 8ê°œ | ì¸ë±ìŠ¤: 5ê°œ | ì™¸ë˜ í‚¤: 2ê°œ
   - INDEX(created_at, action, user_id, employee_id) âœ…
   - ë¡œê·¸ ì¡°íšŒ ì„±ëŠ¥ ìš°ìˆ˜

---

## âœ… ìµœì í™” ì ìš© ê²°ê³¼

### ë°±ì—… í…Œì´ë¸” ì •ë¦¬
~~ë‹¤ìŒ ë°±ì—… í…Œì´ë¸”ë“¤ì´ 2025-11-25ì— ìƒì„±ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤:~~

1. ~~`backup_vehicle_consumable_stock_20251125`~~ â†’ **ì‚­ì œ ì™„ë£Œ** âœ…
2. ~~`backup_vehicle_consumable_usage_20251125`~~ â†’ **ì‚­ì œ ì™„ë£Œ** âœ…
3. ~~`backup_vehicle_consumables_categories_20251125`~~ â†’ **ì‚­ì œ ì™„ë£Œ** âœ…

**ê²°ê³¼**: í…Œì´ë¸” ìˆ˜ 40ê°œ â†’ **37ê°œ**

---

## ğŸ¯ ìµœì í™” ì ìš© ë‚´ì—­

### 1. ì¤‘ë³µ ì¸ë±ìŠ¤ ì œê±° ì™„ë£Œ âœ…

#### supply_items
```sql
-- âœ… ì ìš© ì™„ë£Œ
ALTER TABLE supply_items DROP INDEX idx_item_code;
```
**ê²°ê³¼**: ì¸ë±ìŠ¤ 5ê°œ â†’ 4ê°œ

#### supply_stocks
```sql
-- âœ… ì ìš© ì™„ë£Œ
ALTER TABLE supply_stocks DROP INDEX idx_item_id;
```
**ê²°ê³¼**: ì¸ë±ìŠ¤ 4ê°œ â†’ 3ê°œ

### 2. ì™¸ë˜ í‚¤ ì¸ë±ìŠ¤ ê²€ì¦ ê²°ê³¼

âœ… **ëª¨ë“  ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ê°€ ì¡´ì¬í•©ë‹ˆë‹¤**
- ì´ 51ê°œì˜ ì™¸ë˜ í‚¤ ëª¨ë‘ ì ì ˆí•œ ì¸ë±ìŠ¤ ë³´ìœ 
- JOIN ì„±ëŠ¥ ìµœì í™” ì™„ë£Œ

### 3. ë³µí•© ì¸ë±ìŠ¤ í™œìš© ìš°ìˆ˜

ë‹¤ìŒ í…Œì´ë¸”ë“¤ì€ ë³µí•© ì¸ë±ìŠ¤ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤:

- `hr_leave_applications`: (employee_id, start_date, end_date)
- `hr_leave_logs`: (employee_id, grant_year)
- `supply_purchases`: (item_id, purchase_date)
- `supply_distributions`: ì—¬ëŸ¬ ë³µí•© ì¸ë±ìŠ¤ë¡œ ë‹¤ì–‘í•œ ì¡°íšŒ íŒ¨í„´ ì§€ì›
- `waste_collections`: (latitude, longitude) - ì§€ë„ ê¸°ë°˜ ì¡°íšŒ
- `vehicle_maintenance`: (type, status) - ìƒíƒœë³„ ì¡°íšŒ

### 4. VIRTUAL ì»¬ëŸ¼ í™œìš©

ë‹¤ìŒ í…Œì´ë¸”ë“¤ì€ VIRTUAL ì»¬ëŸ¼ìœ¼ë¡œ ê³„ì‚° ì»¬ëŸ¼ì„ êµ¬í˜„:
- `supply_stocks.current_stock` = total_purchased - total_distributed
- `supply_plans.total_budget` = planned_quantity * unit_price
- `supply_purchases.total_amount` = quantity * unit_price

âœ… ë°ì´í„° ì¼ê´€ì„± ë³´ì¥ ë° ì €ì¥ ê³µê°„ ì ˆì•½

---

## âœ¨ ê°•ì 

1. **ì™¸ë˜ í‚¤ ë¬´ê²°ì„±**: ëª¨ë“  ì™¸ë˜ í‚¤ì— ì ì ˆí•œ ì¸ë±ìŠ¤ ì¡´ì¬
2. **ë³µí•© ì¸ë±ìŠ¤**: íš¨ê³¼ì ì¸ ë³µí•© ì¸ë±ìŠ¤ í™œìš©ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”
3. **UNIQUE ì œì•½ì¡°ê±´**: ì¤‘ìš” ì»¬ëŸ¼ì— UNIQUE ì œì•½ì¡°ê±´ ì ìš©
4. **ê°ì‚¬ ë¡œê·¸**: ë³€ê²½ ì´ë ¥ ì¶”ì  ì‹œìŠ¤í…œ êµ¬ì¶•
5. **ê³„ì¸µ êµ¬ì¡°**: ë¶€ì„œ, ì¹´í…Œê³ ë¦¬ ë“± ê³„ì¸µ êµ¬ì¡° íš¨ìœ¨ì  ê´€ë¦¬
6. **VIRTUAL ì»¬ëŸ¼**: ê³„ì‚° ì»¬ëŸ¼ ìë™í™”ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

---

## ğŸ“ ê²°ë¡ 

ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆëŠ” **ì „ë°˜ì ìœ¼ë¡œ ìš°ìˆ˜í•œ ì„¤ê³„**ë¥¼ ë³´ì—¬ì£¼ë©°, **ìµœì í™”ê°€ ì™„ë£Œ**ë˜ì—ˆìŠµë‹ˆë‹¤:

- âœ… ì •ê·œí™”ê°€ ì˜ ë˜ì–´ ìˆìŒ
- âœ… ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ì´ ì ì ˆíˆ ì„¤ì •ë¨
- âœ… ì¸ë±ìŠ¤ êµ¬ì„±ì´ íš¨ìœ¨ì  (ì¤‘ë³µ ì¸ë±ìŠ¤ ì œê±° ì™„ë£Œ)
- âœ… ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ë³µí•© ì¸ë±ìŠ¤ í™œìš©
- âœ… ê°ì‚¬ ë¡œê·¸ ë° ì´ë ¥ ê´€ë¦¬ ì²´ê³„ì 
- âœ… ë¶ˆí•„ìš”í•œ ë°±ì—… í…Œì´ë¸” ì •ë¦¬ ì™„ë£Œ

**ìµœì í™” ê²°ê³¼**:
- âœ… ì¤‘ë³µ ì¸ë±ìŠ¤ 2ê°œ ì œê±° ì™„ë£Œ
- âœ… ë°±ì—… í…Œì´ë¸” 3ê°œ ì •ë¦¬ ì™„ë£Œ
- âœ… ìŠ¤í‚¤ë§ˆ í¬ê¸° ìµœì í™”: 65,762 bytes â†’ 63,007 bytes (-2,755 bytes)

---

**ë¶„ì„ ì™„ë£Œ**: 2025-11-27  
**ë‹¤ìŒ ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸ ì‹œ**: `php database/scripts/export_schema_pdo.php` ì‹¤í–‰
