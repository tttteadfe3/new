# API 개발 가이드

## 1. API 응답 형식 표준화

모든 API 엔드포인트(` /api/* `)는 일관된 JSON 응답 구조를 반환해야 합니다.

### 1.1. 성공 응답 (2xx)

-   **구조**:
    ```json
    {
        "success": true,
        "message": "요청이 성공적으로 처리되었습니다.",
        "data": {
            // 요청 결과 데이터
        }
    }
    ```
-   **필드 설명**:
    -   `success`: 항상 `true` 값을 가집니다.
    -   `message`: 작업 결과를 설명하는 문자열입니다.
    -   `data`: 필수 필드이며, 조회 결과(객체 또는 배열), 생성/수정된 리소스의 ID 등을 포함합니다. 데이터가 없는 경우 `null` 또는 빈 배열 `[]`을 반환합니다.

### 1.2. 실패 응답 (4xx, 5xx)

-   **구조**:
    ```json
    {
        "success": false,
        "message": "사용자가 이해할 수 있는 에러 메시지입니다.",
        "error_code": "ERROR_CODE",
        "data": null
    }
    ```
-   **필드 설명**:
    -   `success`: 항상 `false` 값을 가집니다.
    -   `message`: 사용자에게 표시될 수 있는 명확한 에러 메시지입니다.
    -   `error_code`: 에러 유형을 식별할 수 있는 고유한 문자열입니다. (예: `INVALID_INPUT`, `UNAUTHENTICATED`, `SERVER_ERROR`)
    -   `data`: 실패 응답에서는 항상 `null`입니다.

## 2. 에러 처리 (Error Handling)

### 2.1. 예외 처리 전략

-   **기본 원칙**: 예측 가능한 오류(예: 사용자 입력 유효성 검사 실패)는 반환 값을 통해 처리하고, 예측 불가능한 예외(예: 데이터베이스 연결 실패, 외부 API 오류)는 `try-catch` 블록을 사용하여 처리합니다.
-   **`try-catch` 사용 규칙**:
    -   `try` 블록은 가능한 작게 유지하여, 예외가 발생할 수 있는 특정 코드 영역만 감쌉니다.
    -   `catch` 블록에서는 예외를 잡은 후, 단순히 무시하지 말고 반드시 로깅하거나 적절한 사용자 피드백을 제공해야 합니다.
    -   필요 시, 잡은 예외를 더 구체적인 커스텀 예외로 감싸서 다시 던질 수 있습니다.

### 2.2. 커스텀 예외 클래스

-   애플리케이션의 도메인에 맞는 커스텀 예외 클래스를 `app/Exceptions/` 디렉토리 내에 정의하여 사용합니다. (예: `PermissionDeniedException`, `RecordNotFoundException`)
-   커스텀 예외를 사용하면, `catch` 블록에서 예외 유형에 따라 분기 처리가 용이해져 코드의 가독성과 유지보수성이 향상됩니다.

## 3. 로깅 (Logging) 정책

### 3.1. 무엇을 로깅할 것인가

-   **에러 및 예외**: 모든 처리되지 않은 예외와 명시적으로 `catch`된 중요한 예외들.
-   **주요 비즈니스 이벤트**: 사용자의 로그인/로그아웃, 주요 데이터 생성/수정/삭제 (예: 직원 정보 변경, 역할 권한 부여), 결제 처리 등 감사 추적이 필요한 이벤트.
-   **외부 API 통신**: 외부 API 요청 및 응답 내용 (단, 민감 정보는 제외).
-   **성능 관련 지표**: 특정 작업의 실행 시간, 느린 쿼리 등 성능 분석에 필요한 정보.

### 3.2. 로그 레벨

-   **DEBUG**: 개발 환경에서만 사용하며, 변수 값이나 특정 코드 경로 실행 여부 등 상세한 디버깅 정보.
-   **INFO**: 사용자 로그인, 데이터 생성 등 정상적인 애플리케이션의 주요 흐름을 나타내는 정보.
-   **WARNING**: 심각한 오류는 아니지만, 잠재적인 문제를 나타낼 수 있는 상황 (예: deprecated된 API 사용, 잘못된 설정 값).
-   **ERROR**: `try-catch`로 처리된 예외, 외부 시스템 연동 실패 등 즉각적인 조치가 필요할 수 있는 심각한 오류.

### 3.3. 로그 파일 관리

-   **위치**: 모든 로그는 `storage/logs/` 디렉토리에 저장됩니다.
    -   일반 애플리케이션 로그: `application.log`
    -   느린 쿼리 로그: `slow_query.log`
-   **로테이션 정책**: 로그 파일은 매일 자정(00:00)을 기준으로 자동으로 로테이션되며, `application-YYYY-MM-DD.log` 형식으로 아카이빙됩니다. 아카이브된 로그 파일은 30일간 보관 후 자동으로 삭제됩니다.

### 3.4. 민감 정보 로깅 금지

-   **엄격한 원칙**: 개인정보(주민등록번호, 주소, 연락처), 금융 정보(계좌번호, 카드번호), 인증 정보(비밀번호, API 키, 토큰)는 **절대로** 로그에 기록해서는 안 됩니다.
-   **필터링**: 로깅 유틸리티를 사용하여, 민감 정보로 의심되는 키(예: `password`, `api_key`, `token`)를 가진 데이터는 자동으로 `[REDACTED]`와 같은 마스킹 처리된 후 로그에 기록되도록 설정합니다.
