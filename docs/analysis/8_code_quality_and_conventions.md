# 8. 코드 품질 및 규칙 분석

## 8.1. 분석

이 애플리케이션의 코드베이스는 공식적인 코딩 표준 강제 도구 없이 작성되었음에도 불구하고, 전반적으로 일관성을 유지하려는 노력이 엿보이며 가독성이 좋은 편입니다. 하지만 몇 가지 측면에서 비일관적인 부분과 개선의 여지가 발견되었습니다.

### 8.1.1. 네이밍 컨벤션 (Naming Conventions)

-   **클래스**: `PascalCase`를 일관되게 사용하고 있습니다 (예: `BaseController`, `AuthService`). 이는 PSR-1 표준을 잘 따르고 있습니다.
-   **메서드**: `camelCase`를 일관되게 사용하고 있습니다 (예: `isLoggedIn`, `getCommonData`). 이 또한 PSR-1 표준을 잘 따릅니다.
-   **변수**: `camelCase`를 주로 사용하지만(`$viewData`), 간혹 `snake_case`(`$permission_key`)가 혼용되는 경우가 있습니다.
-   **데이터베이스 테이블 및 컬럼**: 모든 테이블과 컬럼 이름에 `snake_case`를 일관되게 사용하고 있습니다 (예: `sys_users`, `parent_id`). 이는 매우 좋은 관례입니다.

### 8.1.2. 코드 스타일 및 구조

-   **일관성**: 전반적으로 코드 들여쓰기나 중괄호 사용 스타일이 일관적인 편입니다.
-   **주석 및 문서화**:
    -   주요 클래스와 메서드 상단에 PHPDoc 형태의 주석(`/** ... */`)이 잘 작성되어 있어 코드의 역할과 파라미터, 반환 타입을 이해하는 데 큰 도움이 됩니다.
    -   하지만 일부 메서드나 복잡한 로직 블록에는 주석이 부족하여 코드의 의도를 파악하는 데 시간이 더 소요될 수 있습니다.
-   **클래스 및 메서드 길이**: 대부분의 클래스와 메서드가 단일 책임 원칙(Single Responsibility Principle)을 비교적 잘 지키고 있어 길이가 과도하게 길지 않습니다. 예외적으로 `MenuRepository`의 `getVisibleMenus` 메서드는 다소 복잡하고 길지만, 이는 복잡한 비즈니스 로직의 특성으로 볼 수 있습니다.

### 8.1.3. 주요 문제점: 설계의 비일관성

-   **정적(Static) vs. 인스턴스(Instance) 사용**:
    -   가장 눈에 띄는 비일관성은 클래스의 사용 방식입니다. `Router`, `Database`, `ViewDataService` 등 많은 핵심 클래스들이 정적 메서드만으로 구성되어 있는 반면, `AuthService`, `BaseController` 등은 인스턴스 기반으로 동작합니다.
    -   이러한 혼용은 코드의 예측 가능성을 떨어뜨리고, 특히 유닛 테스트 작성을 어렵게 만드는 주요 원인이 됩니다. 정적 클래스는 상태를 전역적으로 공유하게 되어 테스트 간의 격리가 어렵기 때문입니다.

## 8.2. 개선 방안 및 제안

코드의 일관성을 높이고 장기적인 유지보수 비용을 줄이기 위해 다음과 같은 도구와 규칙을 도입할 것을 강력히 권장합니다.

### 제안 1: 코딩 표준(PSR-12) 공식 도입 및 강제화

-   **문제점**: 공식적인 코딩 표준이 없어 개발자의 스타일에 따라 미세한 비일관성이 발생할 수 있습니다.
-   **개선 방안**: PHP 커뮤니티의 표준 권장 사항인 **PSR-12(Extended Coding Style Guide)**를 프로젝트의 공식 코딩 표준으로 채택하는 것을 제안합니다. PSR-12는 들여쓰기, 네임스페이스 선언, 제어 구조 등 코드 스타일에 대한 명확한 규칙을 제공합니다.
-   **자동화 도구**: **PHP_CodeSniffer (`phpcs`)**를 도입하여 PSR-12 표준을 자동으로 검사하고 수정할 수 있습니다.
    -   `composer require --dev friendsofphp/php-cs-fixer` 또는 `squizlabs/php_codesniffer`를 통해 설치합니다.
    -   Git의 pre-commit hook에 `phpcs`를 연동하면, 코드가 저장소에 커밋되기 전에 코딩 표준을 위반하는 부분을 자동으로 수정하거나 경고를 표시하여 모든 팀원이 일관된 스타일을 유지하도록 강제할 수 있습니다.

### 제안 2: 정적 분석(Static Analysis) 도구 도입

-   **문제점**: 코드를 실행하지 않고는 잠재적인 타입 오류, 잘못된 메서드 호출, 사용되지 않는 변수 등의 버그를 찾기 어렵습니다.
-   **개선 방안**: **PHPStan**이나 **Psalm**과 같은 정적 분석 도구를 도입하는 것을 권장합니다.
    -   `composer require --dev phpstan/phpstan`을 통해 설치할 수 있습니다.
    -   이 도구들은 코드베이스 전체를 분석하여 PHPDoc 주석이나 타입 힌트를 기반으로 잠재적인 오류를 수십 가지 유형으로 찾아줍니다.
    -   점진적으로 도입할 수 있으며(처음에는 가장 낮은 레벨에서 시작), CI/CD 파이프라인에 통합하면 코드 품질을 매우 높은 수준으로 자동 관리할 수 있습니다.

### 제안 3: 설계 원칙의 일관성 확보

-   **문제점**: 정적 클래스와 인스턴스 기반 클래스가 혼재되어 있습니다.
-   **개선 방안**: 아키텍처 분석에서 제안했듯이, **서비스와 리포지토리 계층은 가급적 인스턴스 기반으로 통일**하는 방향으로 점진적인 리팩토링을 진행하는 것이 좋습니다.
    -   이는 의존성 주입(Dependency Injection)을 적용하기 위한 기반이 되며, 테스트하기 쉽고 유연한 코드를 작성하는 데 핵심적인 역할을 합니다.
    -   모든 것을 한 번에 바꿀 필요는 없습니다. 새로운 기능을 개발하거나 기존 코드를 수정할 때 이 원칙을 적용해나가면 점진적으로 코드베이스 전체의 품질을 향상시킬 수 있습니다.