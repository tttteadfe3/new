# 조직 관리 기능 개발 과정 요약

이 문서는 최근 진행된 조직 관리 기능 개편에 대한 요구사항, 개발 진행 과정, 그리고 향후 개선 과제를 요약합니다.

## 1. 초기 요구사항

- **부서장 기능 제거**: 기존의 단일 '부서장' 개념을 폐기하고, 보다 유연한 권한 관리 시스템으로 대체합니다.
- **데이터 조회 권한 시스템 도입**:
    - 특정 직원 또는 부서 단위로 다른 부서의 데이터를 조회할 수 있는 권한을 부여합니다.
    - 권한은 하위 부서에 자동으로 상속됩니다. (예: A 부서 조회 권한이 있으면, A의 모든 하위 부서 데이터도 조회 가능)
- **부서 계층 구조 관리**: `hr_departments` 테이블에 `path` 필드를 추가하여 부서의 계층 구조를 효율적으로 관리하고 조회할 수 있도록 합니다.
- **직급 레벨 도입 및 정렬 기준 중앙화**:
    - `hr_positions` 테이블에 `level` 필드를 추가하여 직급의 서열을 정의합니다.
    - 애플리케이션 전체에서 직원 목록을 조회할 때, '직급 레벨' 오름차순, '입사일' 오름차순으로 정렬 기준을 통일합니다.
- **아키텍처 분리**: `PositionController`를 웹 페이지 렌더링과 API 데이터 처리가 명확히 분리된 구조로 리팩토링합니다.

## 2. 개발 진행 과정

### 데이터베이스 스키마 변경
- **`hr_departments`**: `path` 컬럼을 추가하고, 기존의 단순 권한 플래그(`can_view_all_employees`)를 제거했습니다.
- **`hr_positions`**: 직급 서열을 위한 `level` 컬럼을 추가했습니다.
- **`hr_department_managers`**: 테이블의 용도를 '부서장'에서 '특정 부서의 데이터 조회 권한을 가진 직원'을 매핑하는 역할로 변경했습니다.
- **`hr_department_view_permissions`**: 'A 부서가 B 부서의 데이터를 조회할 수 있다'는 부서 간의 조회 권한을 설정하기 위한 신규 테이블을 추가했습니다.
- **`database/seeds/*.sql`**: 초기 데이터 삽입 스크립트에 새로운 '직급 관리' 메뉴와 관련 권한(`organization.manage`)을 추가하고, `schema.sql`에서 데이터 삽입부를 제거하여 시딩 충돌 문제를 해결했습니다.

### 백엔드 리팩토링 (중앙화된 권한 관리)
- **`OrganizationService`**: `getVisibleDepartmentIdsForCurrentUser` 메서드를 신설하여 권한 관리 로직을 중앙화했습니다.
- 이 메서드는 현재 사용자의 기본 소속, 개별적으로 부여받은 직원 단위 권한, 부서 단위 권한을 모두 종합하여 최종적으로 조회 가능한 모든 부서 ID 목록을 계산합니다.
- **전체 서비스 적용**: `EmployeeService`, `LeaveService`, `UserService`, `HolidayService` 등 데이터를 조회하는 모든 관련 서비스가 위 중앙화된 권한 관리 메서드를 사용하도록 코드를 전면 수정하여 일관성을 확보했습니다.

### 직원 정렬 로직 중앙화
- **`EmployeeRepository`**: 모든 직원 조회 관련 메서드( `getAll`, `findAllActive` 등)에 `ORDER BY p.level ASC, e.hire_date ASC` 정렬 로직을 적용하여 애플리케이션 전체의 정렬 기준을 통일했습니다.

### 직급 관리 기능 (Position Management)
- 직급(Position)의 생성, 조회, 수정, 삭제(CRUD)가 가능한 완전한 MVC 구조를 구현했습니다.
- **`Web\PositionController`**: 웹 페이지(목록, 생성, 수정 화면) 렌더링을 담당합니다.
- **`Api\PositionApiController`**: 데이터 생성, 수정, 삭제 요청을 처리하고 JSON 응답을 반환합니다.
- **`PositionService` / `PositionRepository`**: 비즈니스 로직과 데이터베이스 접근을 각각 담당합니다.

### 프런트엔드 UI 수정
- **부서 관리**: 기존 부서장 선택 UI를 제거하고, '조회 가능 직원'과 '조회 가능 부서'를 선택할 수 있는 다중 선택(multi-select) UI로 교체했습니다.
- **직급 관리**: 직급 목록, 생성, 수정 페이지를 새롭게 개발했습니다.
- **비동기 API 연동**: 모든 폼(form) 제출 로직을 기존의 동기식 방식에서 JavaScript `fetch` API를 사용한 비동기 방식으로 변경하여 사용자 경험을 개선했습니다.

## 3. 향후 과제 및 개선 제안

- **테스트 코드 도입**: 현재 프로젝트에는 자동화된 테스트가 부재합니다. 핵심 기능인 권한 관리 로직과 정렬 로직에 대한 단위 테스트(Unit Test) 및 통합 테스트(Integration Test)를 추가하여 코드의 안정성을 확보해야 합니다.
- **프런트엔드 고도화**: 현재 순수 JavaScript와 일부 라이브러리를 사용하고 있습니다. 향후 기능이 복잡해질 것을 대비하여, React 또는 Vue와 같은 모던 프런트엔드 프레임워크를 도입하여 컴포넌트 기반으로 UI를 재구성하면 유지보수성이 크게 향상될 것입니다.
- **권한 관리 UI 개선**: 권한 설정이 복잡해질수록 관리자가 파악하기 어려워질 수 있습니다. '특정 직원이 현재 어떤 부서들을 볼 수 있는가?' 또는 '특정 부서는 현재 누구에게 보여지는가?'를 한눈에 시각적으로 확인할 수 있는 관리자 대시보드 기능을 추가하면 편의성이 증대될 것입니다.
- **성능 최적화**: 직원 및 부서 수가 수천 개 이상으로 늘어날 경우, `path LIKE '...%'` 형태의 쿼리가 성능 저하를 일으킬 수 있습니다. 시스템의 성장을 고려하여 Nested Set 또는 Closure Table과 같은 다른 계층 구조 데이터 관리 방식에 대한 성능 벤치마크 및 도입을 검토할 수 있습니다.
